<script>
import DashboardFilter from './filter.vue';

const ALL = 'all';

export default {
  components: {
    DashboardFilter,
  },
  data: () => ({
    // TODO: Get these from graphQL, or maybe even a hard-coded file.
    filters: [
      {
        name: 'Severity',
        id: 'severity',
        options: [
          { name: 'All severities', id: 'all' },
          { id: 'critical', name: 'Critical' },
          { id: 'high', name: 'High' },
          { id: 'medium', name: 'Medium' },
          { id: 'low', name: 'Low' },
          { id: 'unknown', name: 'Unknown' },
          { id: 'info', name: 'Info' },
          { id: 'undefined', name: 'Undefined' },
        ],
        selection: new Set(['all']),
      },
      {
        name: 'Report type',
        id: 'report_type',
        options: [
          { name: 'All report types', id: 'all' },
          { id: 'container_scanning', name: 'Container Scanning' },
          { id: 'dast', name: 'DAST' },
          { id: 'dependency_scanning', name: 'Dependency Scanning' },
          { id: 'sast', name: 'SAST' },
        ],
        selection: new Set(['all']),
      },
    ],
  }),
  methods: {
    setFilter({ filterId, optionId }) {
      this.filters = this.filters.map(filter => {
        if (filter.id === filterId) {
          let { selection } = filter;

          if (optionId === ALL) {
            selection = new Set([ALL]);
          } else if (selection.has(optionId)) {
            selection.delete(optionId);
          } else {
            selection.delete(ALL);
            selection.add(optionId);
          }

          if (selection.size === 0) {
            selection.add(ALL);
          }

          return {
            ...filter,
            selection,
          };
        }
        return filter;
      });
    },
  },
};
</script>

<template>
  <div class="dashboard-filters border-bottom bg-gray-light">
    <div class="row mx-0 p-2">
      <dashboard-filter
        v-for="filter in filters"
        :key="filter.id"
        class="col-sm-6 col-md-4 col-lg-2 p-2 js-filter"
        :filter="filter"
        @setFilter="setFilter"
      />
    </div>
  </div>
</template>
