<script>
import vulnerabilitySeveritiesCountQuery from '../graphql/vulnerability_severities_count.graphql';
import VulnerabilityCountListLayout from './vulnerability_count_list_layout.vue';

export default {
  components: {
    VulnerabilityCountListLayout,
  },
  props: {
    projectFullPath: {
      type: String,
      required: true,
    },
  },
  data: () => ({
    dashboardCountError: false,
    isLoadingVulnerabilitiesCount: true,
    vulnerabilitiesCount: {},
  }),
  apollo: {
    vulnerabilitiesCount: {
      query: vulnerabilitySeveritiesCountQuery,
      variables() {
        return { fullPath: this.projectFullPath };
      },
      update: ({ project }) => project?.vulnerabilitySeveritiesCount || {},
      result() {
        this.dashboardCountError = false;
        this.isLoadingVulnerabilitiesCount = false;
      },
      error() {
        this.dashboardCountError = true;
        this.isLoadingVulnerabilitiesCount = false;
      },
    },
  },
};
</script>

<template>
  <vulnerability-count-list-layout
    :dashboard-count-error="dashboardCountError"
    :is-loading-vulnerabilities-count="isLoadingVulnerabilitiesCount"
    :vulnerabilities-count="vulnerabilitiesCount"
  />
</template>
