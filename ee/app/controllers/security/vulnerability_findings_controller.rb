# frozen_string_literal: true

module Security
  class VulnerabilityFindingsController < ::Security::ApplicationController
    include ProjectCollectionVulnerabilityFindingsActions

    private

    def vulnerable
      @vulnerable ||= InstanceSecurityDashboard.new(project_ids: valid_project_ids)
    end

    def valid_project_ids
      return security_dashboard_project_ids if request_project_ids.empty?

      security_dashboard_project_ids & request_project_ids
    end

    def request_project_ids
      params.fetch(:project_id, []).map(&:to_i)
    end

    def security_dashboard_project_ids
      current_user.security_dashboard_project_ids
    end
  end
end
