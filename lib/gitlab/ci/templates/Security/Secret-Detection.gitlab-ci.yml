# Read more about this feature here: https://docs.gitlab.com/ee/user/application_security/secret_detection
#
# Configure the scanning tool through the environment variables.
# List of the variables: https://gitlab.com/gitlab-org/security-products/secret_detection#available-variables
# How to set: https://docs.gitlab.com/ee/ci/yaml/#variables

# Read more about this feature here: https://docs.gitlab.com/ee/user/application_security/secret_detection/
#
# Configure the scanning tool through the environment variables.
# List of the variables: https://gitlab.com/gitlab-org/security-products/sast#settings
# How to set: https://docs.gitlab.com/ee/ci/yaml/#variables

variables:
  SECURE_ANALYZERS_PREFIX: "registry.gitlab.com/gitlab-org/security-products/analyzers"
  SECRETS_ANALYZER_IMAGE_TAG: "2"

.secrets-analyzer:
  services: []
  rules:
    - if: $SECRETS_DISABLED
      when: never
    - when: always
  except:
    variables:
      - $SECRETS_DISABLED
  artifacts:
    reports:
      secret-detection: gl-secret-detection-report.json
  script:
    - /analyzer run

secrets-scan:
  extends: .secrets-analyzer
  image:
    name: "$SECURE_ANALYZERS_PREFIX/secrets:$SECRETS_ANALYZER_IMAGE_TAG"

